{"description":"Get a psk-key from a badly configured open swan server","goal":"<p>Retrive preshared key used in IPsec connection, we use aggressive mode to retrieve it from hash used in response packet from server.</p>","solution":"<p>&nbsp;</p>\n<div class=\"large_div ng-binding\">\n<p>Before we start to attack, in that lab it's present a machine with wireshark to see packet exchanged between legitimate client and server.</p>\n<p>Go to <a href=\"https://localhost:14500/?username=wireshark=password=wireshark\">https://localhost:14500/?username=wireshark=password=wireshark</a> and you can see wireshark interface<a href=\"https://10.111.11.151:14500/?username=wireshark=password=wireshark\" target=\"_blank\" rel=\"noopener noreferrer\">.<br /></a></p>\n<p><a href=\"https://10.111.11.151:14500/?username=wireshark=password=wireshark\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"http://localhost/paginainizialewire.png\" alt=\"pagina iniziale wireshark\" width=\"751\" height=\"584\" /></a></p>\n<p>&nbsp;</p>\n<p>Click on eth0 and you can see aggressive mode packets, don't worry every minute is created a new connection to permit wireshark capture packet<img src=\"http://192.168.56.101/esempiocattura.png\" alt=\"Esempio di cattura pacchetti IPsec\" width=\"747\" height=\"585\" /></p>\n<p>&nbsp;</p>\n<p>We can see what is located in aggressive mode packet:</p>\n<p><img src=\"http://192.168.56.101/catturapacchetto.png\" alt=\"cattura di un pacchetto\" width=\"1919\" height=\"559\" /></p>\n<p>Now we can open a kali shell and start attack:</p>\n<p><img src=\"http://192.168.56.101/kali%20shell.png\" alt=\"kali shell\" width=\"1920\" height=\"1017\" /></p>\n<p>We use ike-scan and psk-crask to retrive password, in the kali machine is located a dictonary to retrive password from capture packet.</p>\n<p>First step: we use ike-scan to retrive the packet with hash not encrypted, we can retrive this because aggressive mode not require authentication:</p>\n<p><img src=\"http://192.168.56.101/ike-scan.png\" alt=\"scansione di ike-scan\" width=\"1913\" height=\"233\" /></p>\n<p>Second step: now we can retrive a password with right amount of time (don't worry in this example less than a second):</p>\n<p><img src=\"http://192.168.56.101/psk-crack.png\" alt=\"cracking con dizionario\" width=\"1919\" height=\"89\" /></p>\n<p>Well, congratulation now you have all the data to instaurate a legitimate connession with the server.</p>\n<p>&nbsp;</p>\n</div>","author":"spromano"}
